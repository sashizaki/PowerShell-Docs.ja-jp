---
ms.date: 12/12/2018
keywords: DSC, PowerShell, 構成, セットアップ
title: PowerShell 4.0 での LCM の構成
description: ローカル構成マネージャー (LCM) は、すべてのターゲット ノード上で実行され、ノードに送信される構成の解析と適用を担当します。
ms.openlocfilehash: cf4d8cffdb6492f9f8cdde4cbb82ba5843427cee
ms.sourcegitcommit: 488a940c7c828820b36a6ba56c119f64614afc29
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/27/2020
ms.locfileid: "92646963"
---
# <a name="configuring-the-lcm-in-powershell-40"></a><span data-ttu-id="1fd1b-104">PowerShell 4.0 での LCM の構成</span><span class="sxs-lookup"><span data-stu-id="1fd1b-104">Configuring the LCM in PowerShell 4.0</span></span>

><span data-ttu-id="1fd1b-105">適用先: Windows PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="1fd1b-105">Applies To: Windows PowerShell 4.0</span></span>

<span data-ttu-id="1fd1b-106">**Windows PowerShell 5.0 以降に関連する情報については、「 [ローカル構成マネージャーの構成](metaConfig.md)」を参照してください。**</span><span class="sxs-lookup"><span data-stu-id="1fd1b-106">**For information related to Windows PowerShell 5.0 and later, see [Configuring the Local Configuration Manager](metaConfig.md).**</span></span>

<span data-ttu-id="1fd1b-107">ローカル構成マネージャーは、Windows PowerShell Desired State Configuration (DSC) エンジンです。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-107">Local Configuration Manager is the Windows PowerShell Desired State Configuration (DSC) engine.</span></span> <span data-ttu-id="1fd1b-108">すべてのターゲット ノードで実行され、DSC 構成スクリプトに含まれている構成リソースを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-108">It runs on all target nodes, and it is responsible for calling the configuration resources that are included in a DSC configuration script.</span></span> <span data-ttu-id="1fd1b-109">このトピックでは、ローカル構成マネージャーのプロパティを一覧表示し、ターゲット ノードでローカル構成マネージャーの設定を変更する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-109">This topic lists the properties of Local Configuration Manager and describes how you can modify the Local Configuration Manager settings on a target node.</span></span>

## <a name="local-configuration-manager-properties"></a><span data-ttu-id="1fd1b-110">ローカル構成マネージャーのプロパティ</span><span class="sxs-lookup"><span data-stu-id="1fd1b-110">Local Configuration Manager properties</span></span>

<span data-ttu-id="1fd1b-111">設定または取得できるローカル構成マネージャーのプロパティを次に示します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-111">The following lists the Local Configuration Manager properties that you can set or retrieve.</span></span>

- <span data-ttu-id="1fd1b-112">**AllowModuleOverwrite** : 構成サービスからダウンロードされた新しい構成で、ターゲット ノードの古い構成を上書きできるかどうかを制御します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-112">**AllowModuleOverwrite** : Controls whether new configurations downloaded from the configuration service are allowed to overwrite the old ones on the target node.</span></span> <span data-ttu-id="1fd1b-113">設定可能な値は True および False です。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-113">Possible values are True and False.</span></span>
- <span data-ttu-id="1fd1b-114">**CertificateID** : 構成で渡される資格情報をセキュリティで保護するために使用される証明書の拇印。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-114">**CertificateID** : The thumbprint of a certificate used to secure credentials passed in a configuration.</span></span> <span data-ttu-id="1fd1b-115">詳細については、「[Want to secure credentials in Windows PowerShell Desired State Configuration? (Windows PowerShell Desired State Configuration で資格情報をセキュリティ保護する)](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-115">For more information see [Want to secure credentials in Windows PowerShell Desired State Configuration?](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span></span>
- <span data-ttu-id="1fd1b-116">**ConfigurationID** : プル サービスから特定の構成ファイルを取得するために使用する GUID を指定します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-116">**ConfigurationID** : Indicates a GUID which is used to get a particular configuration file from a pull service.</span></span> <span data-ttu-id="1fd1b-117">この GUID によって、適切な構成ファイルにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-117">The GUID ensures that the correct configuration file is accessed.</span></span>
- <span data-ttu-id="1fd1b-118">**ConfigurationMode** : ローカル構成マネージャーによってターゲット ノードに構成が実際に適用される方法を指定します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-118">**ConfigurationMode** : Specifies how the Local Configuration Manager actually applies the configuration to the target nodes.</span></span> <span data-ttu-id="1fd1b-119">次の値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-119">It can take the following values:</span></span>
  - <span data-ttu-id="1fd1b-120">**ApplyOnly** : このオプションを使用すると、DSC によって構成が適用され、その後何も行われません。ただし、ターゲット ノードに直接新しい構成を送信した場合や、プル サービスに接続しており、DSC が プル サービスを確認して新しい構成を検出した場合を除きます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-120">**ApplyOnly** : With this option, DSC applies the configuration and does nothing further unless a new configuration is detected, either by you sending a new configuration directly to the target node or if you are connecting to a pull service and DSC discovers a new configuration when it checks with the pull service.</span></span> <span data-ttu-id="1fd1b-121">ターゲット ノードの構成のずれが発生した場合、アクションは実行されません。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-121">If the target node's configuration drifts, no action is taken.</span></span>
  - <span data-ttu-id="1fd1b-122">**ApplyAndMonitor** : このオプション (既定) を使用すると、新しい構成をターゲット ノードに直接送信した場合でも、プル サービスで検出された場合でも、DSC によって新しい構成が適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-122">**ApplyAndMonitor** : With this option (which is the default), DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span>
    <span data-ttu-id="1fd1b-123">その後、ターゲット ノードの構成が構成ファイルからずれた場合、DSC はログで不一致を報告します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-123">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs.</span></span> <span data-ttu-id="1fd1b-124">DSC ログの詳細については、「[Using Event Logs to Diagnose Errors in Desired State Configuration (Desired State Configuration でのイベント ログを使用したエラーの診断)](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-124">For more about DSC logging, see [Using Event Logs to Diagnose Errors in Desired State Configuration](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/).</span></span>
  - <span data-ttu-id="1fd1b-125">**ApplyAndAutoCorrect** : このオプションを使用すると、新しい構成をターゲット ノードに直接送信した場合も、プル サービスで検出された場合も、DSC によって新しい構成が適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-125">**ApplyAndAutoCorrect** : With this option, DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="1fd1b-126">その後、ターゲット ノードの構成が構成ファイルからずれた場合、DSC はログで不一致を報告し、構成ファイルに準拠するようにターゲット ノードの構成を調整します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-126">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs, and then attempts to adjust the target node configuration to bring in compliance with the configuration file.</span></span>
- <span data-ttu-id="1fd1b-127">**ConfigurationModeFrequencyMins** : DSC のバックグラウンド アプリケーションがターゲット ノード上の現在の構成の実装を試行する頻度を表します (分単位)。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-127">**ConfigurationModeFrequencyMins** : Represents the frequency (in minutes) at which the background application of DSC attempts to implement the current configuration on the target node.</span></span> <span data-ttu-id="1fd1b-128">既定値は 15 です。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-128">The default value is 15.</span></span> <span data-ttu-id="1fd1b-129">この値は、RefreshMode と組み合わせて設定することができます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-129">This value can be set in conjunction with RefreshMode.</span></span> <span data-ttu-id="1fd1b-130">RefreshMode を PULL に設定すると、ターゲット ノードは RefreshFrequencyMins の設定間隔で構成サービスに接続し、現在の構成をダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-130">When RefreshMode is set to PULL, the target node contacts the configuration service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="1fd1b-131">RefreshMode の値に関係なく、ConfigurationModeFrequencyMins の設定間隔で、整合性エンジンは、ターゲット ノードにダウンロードされた最新の構成を適用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-131">Regardless of the RefreshMode value, at the interval set by ConfigurationModeFrequencyMins, the consistency engine applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="1fd1b-132">RefreshFrequencyMins は、ConfigurationModeFrequencyMins の倍数である整数に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-132">RefreshFrequencyMins should be set to an integer multiple of ConfigurationModeFrequencyMins.</span></span>
- <span data-ttu-id="1fd1b-133">**Credential** : 構成サービスへの接続など、リモート リソースにアクセスするために必要な資格情報を示します (Get-Credential と同様)。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-133">**Credential** : Indicates credentials (as with Get-Credential) required to access remote resources, such as to contact the configuration service.</span></span>
- <span data-ttu-id="1fd1b-134">**DownloadManagerCustomData** : ダウンロード マネージャーに固有のカスタム データを格納する配列を表します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-134">**DownloadManagerCustomData** : Represents an array that contains custom data specific to the download manager.</span></span>
- <span data-ttu-id="1fd1b-135">**DownloadManagerName** : 構成とモジュールのダウンロード マネージャーの名前を示します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-135">**DownloadManagerName** : Indicates the name of the configuration and module download manager.</span></span>
- <span data-ttu-id="1fd1b-136">**RebootNodeIfNeeded** :これを `$true` に設定して、リソースにより `$global:DSCMachineStatus` フラグを使用したノードが再起動されるようにします。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-136">**RebootNodeIfNeeded** : Set this to `$true` to allow resources to reboot the Node using the `$global:DSCMachineStatus` flag.</span></span> <span data-ttu-id="1fd1b-137">設定しない場合は、再起動が必要な構成のノードを手動で再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-137">Otherwise, you will have to manually reboot the node for any configuration that requires it.</span></span> <span data-ttu-id="1fd1b-138">既定値は `$false` です。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-138">The default value is `$false`.</span></span> <span data-ttu-id="1fd1b-139">DSC 以外 (Windows インストーラーなど) で再起動の条件が有効化されている場合にこの設定を使用するには、この設定を [xPendingReboot](https://github.com/powershell/xpendingreboot) モジュールと併用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-139">To use this setting when a reboot condition is enacted by something other than DSC (such as Windows Installer), combine this setting with the [xPendingReboot](https://github.com/powershell/xpendingreboot) module.</span></span>
- <span data-ttu-id="1fd1b-140">**RefreshFrequencyMins** : プル サービスをセットアップするときに使用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-140">**RefreshFrequencyMins** : Used when you have set up a pull service.</span></span> <span data-ttu-id="1fd1b-141">ローカル構成マネージャーが プル サービスに接続して現在の構成をダウンロードする頻度 (分) を表します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-141">Represents the frequency (in minutes) at which the Local Configuration Manager contacts a pull service to download the current configuration.</span></span> <span data-ttu-id="1fd1b-142">この値は、ConfigurationModeFrequencyMins と組み合わせて設定することができます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-142">This value can be set in conjunction with ConfigurationModeFrequencyMins.</span></span> <span data-ttu-id="1fd1b-143">RefreshMode を PULL に設定すると、ターゲット ノードは RefreshFrequencyMins の設定間隔で プル サービスに接続し、現在の構成をダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-143">When RefreshMode is set to PULL, the target node contacts the pull service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="1fd1b-144">その後、ConfigurationModeFrequencyMins の設定間隔で、整合性エンジンがターゲット ノードにダウンロードされた最新の構成を適用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-144">At the interval set by ConfigurationModeFrequencyMins, the consistency engine then applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="1fd1b-145">RefreshFrequencyMins が ConfigurationModeFrequencyMins の倍数である整数に設定されていない場合は、システムによって切り上げられます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-145">If RefreshFrequencyMins is not set to an integer multiple of ConfigurationModeFrequencyMins, the system will round it up.</span></span> <span data-ttu-id="1fd1b-146">既定値は 30 です。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-146">The default value is 30.</span></span>
- <span data-ttu-id="1fd1b-147">**RefreshMode** : 設定可能な値は **Push** (既定値) と **Pull** です。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-147">**RefreshMode** : Possible values are **Push** (the default) and **Pull**.</span></span> <span data-ttu-id="1fd1b-148">"プッシュ" 構成では、任意のクライアント コンピューターを使用して各ターゲット ノードに構成ファイル配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-148">In the "push" configuration, you must place a configuration file on each target node, using any client computer.</span></span>
  <span data-ttu-id="1fd1b-149">"プル" モードでは、構成ファイルに接続およびアクセスするようにローカル構成マネージャーのプル サービスを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-149">In the "pull" mode, you must set up a pull service for Local Configuration Manager to contact and access the configuration files.</span></span>

> [!NOTE]
> <span data-ttu-id="1fd1b-150">LCM は次に基づいて **ConfigurationModeFrequencyMins** サイクルを開始します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-150">The LCM starts the **ConfigurationModeFrequencyMins** cycle based on:</span></span>
>
> - <span data-ttu-id="1fd1b-151">新しいメタ構成が `Set-DscLocalConfigurationManager` を使用して適用される</span><span class="sxs-lookup"><span data-stu-id="1fd1b-151">A new metaconfig is applied using `Set-DscLocalConfigurationManager`</span></span>
> - <span data-ttu-id="1fd1b-152">コンピューターの再起動</span><span class="sxs-lookup"><span data-stu-id="1fd1b-152">A machine restart</span></span>
>
> <span data-ttu-id="1fd1b-153">タイマー プロセスでクラッシュが発生するすべての状況で、それが 30 秒以内に検出され、サイクルが再開されます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-153">For any condition where the timer process experiences a crash, that will be detected within 30 seconds and the cycle will be restarted.</span></span> <span data-ttu-id="1fd1b-154">同時実行操作によって、サイクルの開始が遅延する可能性があり、この操作の期間が構成済みのサイクル頻度を超えた場合、次のタイマーは開始されません。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-154">A concurrent operation could delay the cycle from being started, if the duration of this operation exceeds the configured cycle frequency, the next timer will not start.</span></span>
>
> <span data-ttu-id="1fd1b-155">たとえば、メタ構成が 15 分のプル頻度で構成されており、プルが T1 で発生するとします。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-155">Example, the metaconfig is configured at a 15 minute pull frequency and a pull occurs at T1.</span></span> <span data-ttu-id="1fd1b-156">ノードにより 16 分間で作業が完了されません。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-156">The Node does not finish work for 16 minutes.</span></span> <span data-ttu-id="1fd1b-157">最初の 15 分のサイクルは無視され、次のプルが T1 + 15 + 15 で発生します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-157">The first 15 minute cycle is ignored, and next pull will happen at T1+15+15.</span></span>

### <a name="example-of-updating-local-configuration-manager-settings"></a><span data-ttu-id="1fd1b-158">ローカル構成マネージャー設定の更新の例</span><span class="sxs-lookup"><span data-stu-id="1fd1b-158">Example of updating Local Configuration Manager settings</span></span>

<span data-ttu-id="1fd1b-159">次の例に示すように、構成スクリプトのノード ブロックに **LocalConfigurationManager** ブロックを含めることによって、ターゲット ノードのローカル構成マネージャー設定を更新できます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-159">You can update the Local Configuration Manager settings of a target node by including a **LocalConfigurationManager** block inside the node block in a configuration script, as shown in the following example.</span></span>

```powershell
Configuration ExampleConfig
{
    Node "Server001"
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullService/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called
# Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"
```

<span data-ttu-id="1fd1b-160">前の例のスクリプトを実行すると、目的の設定を指定および格納する MOF ファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-160">Running the script in the previous example generates a MOF file that specifies and stores the desired settings.</span></span> <span data-ttu-id="1fd1b-161">設定を適用するには、次の例に示すように **Set-DscLocalConfigurationManager** コマンドレットを使用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-161">To apply the settings, you can use the **Set-DscLocalConfigurationManager** cmdlet, as shown in the following example.</span></span>

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> [!NOTE]
> <span data-ttu-id="1fd1b-162">**Path** パラメーターには、前の例で構成を呼び出したときに **OutputPath** パラメーターに指定したパスと同じパスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-162">For the **Path** parameter, you must specify the same path that you specified for the **OutputPath** parameter when you invoked the configuration in the previous example.</span></span>

<span data-ttu-id="1fd1b-163">現在のローカル構成マネージャー設定を表示するには、 **Get-DscLocalConfigurationManager** コマンドレットを使用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-163">To see the current Local Configuration Manager settings, you can use the **Get-DscLocalConfigurationManager** cmdlet.</span></span> <span data-ttu-id="1fd1b-164">パラメーターなしでこのコマンドレットを呼び出す場合、既定では、ローカル構成マネージャーを実行しているノードのローカル構成マネージャー設定が取得されます。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-164">If you invoke this cmdlet with no parameters, by default it will get the Local Configuration Manager settings for the node on which you run it.</span></span> <span data-ttu-id="1fd1b-165">別のノードを指定するには、このコマンドレットで **CimSession** パラメーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="1fd1b-165">To specify another node, use the **CimSession** parameter with this cmdlet.</span></span>
